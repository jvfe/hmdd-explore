---
title: "Initial exploration of scraping capabilities in HMDD"
author: "Jo√£o Vitor"
date: "09/07/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(magrittr)
```

## Scraping HMDD

Refactor calls/url building that are common to both functions, get info from diseases too.

```{r}
get_href <- function(url, obj_xpath) {
  xml2::read_html(url) %>% 
    rvest::html_node(xpath = obj_xpath) %>% 
    rvest::html_attr("href")
}

make_hmdd_url <- function(info_type, id, extra_id) {
  sprintf("http://www.cuilab.cn/hmdd3app/%s/%s_%s/", info_type, id, extra_id)
}
```

```{r}
get_hmdd_causality <- function(mirna) {
  
  url <- make_hmdd_url("causality", mirna, "a3")

  result <- get_href(url, '//*[@id="browsedownload"]')

  info <- paste0("http://www.cuilab.cn", result) %>% 
    readLines()
  
  table <- readr::read_tsv(info[2:length(info)]) %>% 
    dplyr::mutate(miRNA = gsub("miRNA name:\t", "", info[1]))
  
}
```

```{r}
get_hmdd_net <- function(mirna) {
  
  url <- make_hmdd_url("browse_net", mirna, "n1")
  
  result <- get_href(url, '/html/body/p/b/span[2]/a')

  info <- paste0("http://www.cuilab.cn", result) %>% 
    readLines() %>% 
    readr::read_tsv()
  
}
```


```{r}
mir101 <- get_hmdd_causality("hsa-mir-101")

mir101_net <- get_hmdd_net("hsa-mir-101")
```

