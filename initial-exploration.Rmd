---
title: "Initial exploration of scraping capabilities in HMDD"
author: "Jo√£o Vitor"
date: "09/07/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Scraping HMDD

Refactor calls/url building that are common to both functions, get info from diseases too.

```{r}
get_hmdd_causality <- function(mirna) {
  
  url <- sprintf("http://www.cuilab.cn/hmdd3app/causality/%s_a3/", mirna)
  
  result <- xml2::read_html(url) %>% 
    rvest::html_node(xpath = '//*[@id="browsedownload"]') %>% 
    rvest::html_attr("href")

  info <- paste0("http://www.cuilab.cn", result) %>% 
    readLines()
  
  table <- readr::read_tsv(info[2:length(info)]) %>% 
    dplyr::mutate(miRNA = gsub("miRNA name:\t", "", info[1]))
  
}
```

```{r}
get_mirna_target_net <- function(mirna) {

  url <- sprintf("http://www.cuilab.cn/hmdd3app/browse_net/%s_n1/", mirna)
  
  result <- xml2::read_html(url) %>% 
    rvest::html_node(xpath = '/html/body/p/b/span[2]/a') %>% 
    rvest::html_attr("href")

  info <- paste0("http://www.cuilab.cn", result) %>% 
    readLines() %>% 
    readr::read_tsv()
  
}
```


```{r}
mir101 <- get_hmdd_causality("hsa-mir-101")

mir101_net <- get_mirna_target_net("hsa-mir-101")
```

